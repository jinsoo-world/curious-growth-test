import { useState, useEffect } from 'react'
import { typeResults } from '../data/questions'
import './ResultPage.css'

const deepReports = {
  A: {
    label: 'ğŸ”¥ A. ì•¼ë§ ìˆëŠ” í¬ë¦¬ì—ì´í„°',
    subtitle: 'ì¸ìƒ 2ë§‰ì˜ ë¶ˆê½ƒ ìŠˆíŒ…ìŠ¤íƒ€',
    tagline: '\"ê·¸ë™ì•ˆ ìŒ“ì•„ì˜¨ ê²½í—˜, ê·¸ëƒ¥ ì©íˆê¸´ ì•„ê¹ì–ì•„ìš”? ì´ì œ ë‚´ ì´ë¦„ìœ¼ë¡œ í•œíŒ ì œëŒ€ë¡œ ë²Œì—¬ë´ì•¼ì£ !\"',
    sections: [
      {
        title: 'ì–´ë–¤ ë§ˆìŒì´ì‹ ê°€ìš”?',
        body: [
          'ì†ì¬ì£¼ë„ ì¢‹ê³ , ì•„ëŠ” ê²ƒë„ ë§ê³ , ë¬´ì—‡ë³´ë‹¤ \"í•œë²ˆ í•´ë³´ì!\" í•˜ëŠ” ì¶”ì§„ë ¥ì´ ëë‚´ì£¼ëŠ” ë¶„ì´ì—ìš”.',
          'ì´ë¯¸ ë¸”ë¡œê·¸, ìœ íŠœë¸Œ, ê¸€ì“°ê¸°, ê°•ì˜ ë“± ì´ê²ƒì €ê²ƒ ì‹œë„í•´ë³´ì…¨ì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.',
          'í•˜ì§€ë§Œ ë§ˆìŒ í•œêµ¬ì„ì—” ì´ëŸ° ì§ˆë¬¸ì´ ë– ì˜¤ë¥´ì£ . \"ì´ì™• í•˜ëŠ” ê±°, ì¢€ ë” ê·¸ëŸ´ì‹¸í•˜ê²Œ ìˆ˜ìµë„ ë‚´ê³  ë‚´ ì´ë¦„ë„ ì œëŒ€ë¡œ ì•Œë¦¬ê³  ì‹¶ì€ë°... ë°©ë²•ì´ ì—†ì„ê¹Œ?\"'
        ]
      },
      {
        title: 'ì´ëŸ° ê³ ë¯¼, ë‹¤ ì•Œì•„ìš”',
        body: [
          'ì—´ì‹¬íˆëŠ” ì‚¬ëŠ”ë°, ì„±ê³¼ê°€ ëˆˆì— í™• ë³´ì´ì§€ ì•Šìœ¼ë©´ ê¸ˆë°© ì§€ì¹˜ê¸° ë§ˆë ¨ì´ì—ìš”.',
          '\"ì´ ë‚˜ì´ì— ë„ˆë¬´ ìš•ì‹¬ë¶€ë¦¬ë‚˜?\" ì‹¶ë‹¤ê°€ë„, ë‚´ ëŠ¥ë ¥ì„ ì¸ì •ë°›ê³  ì‹¶ì€ ë§ˆìŒì€ ë„ˆë¬´ë‚˜ ë‹¹ì—°í•©ë‹ˆë‹¤.'
        ]
      },
      {
        title: 'í•¨ê»˜ í•´ë´ìš”',
        body: [
          'ë‹¹ì‹ ì˜ ëœ¨ê±°ìš´ ì—ë„ˆì§€ê°€ í—›ë˜ì§€ ì•Šë„ë¡ **ëˆì´ ë˜ëŠ” ì‹œìŠ¤í…œ**ì„ ì…í˜€ë“œë¦¬ëŠ” ê²ƒì´ í•„ìš”í•©ë‹ˆë‹¤.',
          'ë³µì¡í•œ ì´ë¡  ëŒ€ì‹ , ë‹¹ì‹ ì˜ ì•„ì´ë””ì–´ê°€ ê·¼ì‚¬í•œ ê²°ê³¼ë¬¼ì´ ë˜ì–´ ì„¸ìƒì— ì•Œë ¤ì§€ë„ë¡ ë•ëŠ” êµ¬ì¡°ê°€ ì¤‘ìš”í•´ìš”.',
          'ì´ì œ ê´€ê°ì´ ì•„ë‹ˆë¼ **ì£¼ì¸ê³µ**ìœ¼ë¡œ ë¬´ëŒ€ì— ì„œë³¼ ì°¨ë¡€ì…ë‹ˆë‹¤.'
        ]
      }
    ]
  },
  B: {
    label: 'âš¡ B. ê²°ì •í˜• ë¦¬ë”',
    subtitle: 'ì„¸ìƒ ëŒì•„ê°€ëŠ” ì´ì¹˜ì— ë°ì€ ì§€í˜œë¡œìš´ íšŒì¥ë‹˜',
    tagline: '\"ë³µì¡í•œ ê±´ ë”± ì§ˆìƒ‰! í•µì‹¬ë§Œ ë”± ì§šì–´ì£¼ë©´, ê·¸ë‹¤ìŒë¶€í„´ ì œê°€ ì•Œì•„ì„œ ê²°ì •í•©ë‹ˆë‹¤.\"',
    sections: [
      {
        title: 'ì–´ë–¤ ë§ˆìŒì´ì‹ ê°€ìš”?',
        body: [
          'ì‚°ì „ìˆ˜ì „ ë‹¤ ê²ªì–´ë³¸ ë² í…Œë‘, í•˜ë‚˜ë¥¼ ë³´ë©´ ì—´ì„ ì•„ëŠ” ì•ˆëª©ì„ ê°€ì§€ì‹  ë¶„ì´ì—ìš”.',
          'ë‹¹ì‹ ì—ê²Œ ì‹œê°„ì€ ê³§ ëˆì´ê³ , ì§ì ‘ ì»´í“¨í„° ì•ì— ì•‰ì•„ ì”¨ë¦„í•˜ê¸°ë³´ë‹¤ëŠ” **ì´ê²Œ ë˜ëŠ” ì¼ì¸ì§€** íŒë‹¨í•˜ê³  ë°©í–¥ì„ ì¡ëŠ” ë° ê°•ì ì´ ìˆìŠµë‹ˆë‹¤.'
        ]
      },
      {
        title: 'ì´ëŸ° ê³ ë¯¼, ë‹¤ ì•Œì•„ìš”',
        body: [
          '\"ë‚´ê°€ êµ³ì´ ì´ê±¸ ë‹¤ ë°°ì›Œì•¼ í•´? ì˜í•˜ëŠ” ì‚¬ëŒí•œí…Œ ì‹œí‚¤ëŠ” ê²Œ ë¹ ë¥´ì§€!\"',
          'ë§ì•„ìš”. í•˜ë‚˜ë¶€í„° ì—´ê¹Œì§€ ë°°ìš°ëŠë¼ í˜ ë¹¼ê¸°ë³´ë‹¤ëŠ”, ì œëŒ€ë¡œ ëœ ì‚¬ëŒì—ê²Œ ë§¡ê¸°ëŠ” ê²ƒì´ í›¨ì”¬ íš¨ìœ¨ì ì¸ íƒ€ì…ì…ë‹ˆë‹¤.'
        ]
      },
      {
        title: 'í•¨ê»˜ í•´ë´ìš”',
        body: [
          'ì‹œí–‰ì°©ì˜¤ë¡œ ë²„ë¦¬ëŠ” ì‹œê°„ì„ ì¤„ì´ê³ , **ì•Œë§¹ì´ë§Œ ë‹´ê¸´ ë§ì¶¤í˜• ê°€ì´ë“œ**ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
          'ë‹¹ì‹ ì€ ì¤‘ìš”í•œ ì˜ì‚¬ê²°ì •ì—ë§Œ ì§‘ì¤‘í•˜ê³ , ì‹¤í–‰ê³¼ ì„¸ë¶€ ì„¤ê³„ëŠ” ì „ë¬¸ê°€ì—ê²Œ ë§¡ê¸°ëŠ” ë°©ì‹ì´ ê°€ì¥ ì˜ ë§ìŠµë‹ˆë‹¤.'
        ]
      }
    ]
  },
  C: {
    label: 'ğŸŒ± C. ì„±ì¥ íƒìƒ‰ì',
    subtitle: 'ìˆ˜ì¤ì§€ë§Œ ë§ˆìŒë§Œì€ ë‚­ë§Œ ê°€ë“í•œ ëª¨í—˜ê°€',
    tagline: '\"ì‹œì‘ì´ ë°˜ì´ë¼ëŠ”ë°, ê·¸ ì‹œì‘ì´ ì œì¼ ì–´ë µë„¤ìš”. ëˆ„ê°€ ì˜†ì—ì„œ \'ê´œì°®ë‹¤\'ê³  ì†ë§Œ ì¡ì•„ì£¼ë©´ ì˜í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì€ë°...\"',
    sections: [
      {
        title: 'ì–´ë–¤ ë§ˆìŒì´ì‹ ê°€ìš”?',
        body: [
          'ë°°ìš°ê³  ì‹¶ì€ ê²ƒë„ ë§ê³  í˜¸ê¸°ì‹¬ë„ ê°€ë“í•˜ì§€ë§Œ, ë‚¨ë“¤ ì•ì— ì„œëŠ” ê±´ ê´œíˆ ì‘¥ìŠ¤ëŸ½ê³  ë§ì„¤ì—¬ì§€ì‹œëŠ”êµ°ìš”.',
          '\"ë‚´ê°€ ì˜í•  ìˆ˜ ìˆì„ê¹Œ?\", \"ë‚¨ë“¤ì´ ë³´ë©´ ì›ƒì§€ ì•Šì„ê¹Œ?\" í•˜ëŠ” ê±±ì • ë•Œë¬¸ì— ì‹œì‘ì„ ìê¾¸ ë‚´ì¼ë¡œ ë¯¸ë£¨ê²Œ ë˜ì…¨ì„ ìˆ˜ ìˆì–´ìš”.'
        ]
      },
      {
        title: 'ì´ëŸ° ê³ ë¯¼, ë‹¤ ì•Œì•„ìš”',
        body: [
          'ì•„ì§ ì¤€ë¹„ê°€ ì•ˆ ëœ ê²Œ ì•„ë‹ˆë¼, ì¡°ê¸ˆ ë” ë”°ëœ»í•˜ê³  ì•ˆì „í•œ **ì‘ì›ê³¼ í™˜ê²½**ì´ ë¶€ì¡±í–ˆì„ ë¿ì…ë‹ˆë‹¤.',
          'ì™„ë²½í•˜ê²Œ í•´ë‚´ì•¼ í•œë‹¤ëŠ” ë¶€ë‹´ê°ì´ ë‹¹ì‹ ì˜ ë°œê±¸ìŒì„ ë¬´ê²ê²Œ ë§Œë“¤ì—ˆì„ ê°€ëŠ¥ì„±ì´ ì»¤ìš”.'
        ]
      },
      {
        title: 'í•¨ê»˜ í•´ë´ìš”',
        body: [
          'ë‚¨ë“¤ ëˆˆì¹˜ ë³´ì§€ ì•Šì•„ë„ ë˜ëŠ” ì‘ì€ ì‹œë„ë¶€í„°, ê°€ë³ê²Œ, ì²œì²œíˆ ì‹œì‘í•´ë³´ë©´ ì¢‹ìŠµë‹ˆë‹¤.',
          'ì•„ë¬´ë„ í‰ë³´ì§€ ì•ŠëŠ” í¸ì•ˆí•œ ê³µê°„ì—ì„œ ë‹¹ì‹ ë§Œì˜ ì†ë„ë¡œ ê±·ë‹¤ ë³´ë©´, ì–´ëŠìƒˆ ë¶€ì© ì„±ì¥í•œ ìì‹ ì„ ë°œê²¬í•˜ê²Œ ë  ê±°ì˜ˆìš”.',
          'ì €í¬ê°€ ê·¸ ì˜†ì„ í•¨ê»˜ ê±¸ì–´ê°€ëŠ” **ë“ ë“ í•œ í¸**ì´ ë˜ì–´ ë“œë¦´ê²Œìš”.'
        ]
      }
    ]
  },
  D: {
    label: 'ğŸ“˜ D. ì¡°ìš©í•œ ì‹¤ë ¥ì',
    subtitle: 'ê¹Šì€ ì‚°ì† ì˜¹ë‹¬ìƒ˜ ê°™ì€ ë‚´ê³µì˜ ê³ ìˆ˜',
    tagline: '\"ë– ë²Œë¦¬ëŠ” ê±´ ì²´ì§ˆì— ì•ˆ ë§ì•„ìš”. í•˜ì§€ë§Œ ë‚´ ì¸ìƒì´ ë‹´ê¸´ ì†Œì¤‘í•œ ê¸°ë¡ í•˜ë‚˜ì¯¤ì€ ë‚¨ê¸°ê³  ì‹¶ë„¤ìš”.\"',
    sections: [
      {
        title: 'ì–´ë–¤ ë§ˆìŒì´ì‹ ê°€ìš”?',
        body: [
          'ê²‰ìœ¼ë¡œëŠ” ì¡°ìš©í•´ ë³´ì´ì§€ë§Œ, ì†ì—ëŠ” ê±°ëŒ€í•œ ë„ì„œê´€ì´ ë“¤ì–´ìˆëŠ” ë¶„ì´ì—ìš”.',
          'ë¬µë¬µíˆ í•œ ê¸¸ì„ ê±¸ì–´ì˜¤ë©° ìŒ“ì•„ì˜¨ ë‹¹ì‹ ë§Œì˜ ì§€í˜œì™€ ì² í•™ì€ ì •ë§ ë³´ë¬¼ê³¼ë„ ê°™ìŠµë‹ˆë‹¤.'
        ]
      },
      {
        title: 'ì´ëŸ° ê³ ë¯¼, ë‹¤ ì•Œì•„ìš”',
        body: [
          '\"ë‚´ ê²½í—˜ì´ ì±…ì´ ë ê¹Œ? ì •ë¦¬ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í•˜ì§€?\"',
          'ë§ë¡œ í•˜ë©´ ìˆ ìˆ  ë‚˜ì˜¤ì§€ë§Œ, ë§‰ìƒ ê¸€ê³¼ ê²°ê³¼ë¬¼ë¡œ ë§Œë“¤ë ¤ë‹ˆ ì–´ë””ì„œë¶€í„° ì†ëŒ€ì•¼ í• ì§€ ë§‰ë§‰í•˜ì…¨ì„ ê±°ì˜ˆìš”.'
        ]
      },
      {
        title: 'í•¨ê»˜ í•´ë´ìš”',
        body: [
          'ì–µì§€ë¡œ ìì‹ ì„ ë“œëŸ¬ë‚´ì§€ ì•Šì•„ë„ ê´œì°®ìŠµë‹ˆë‹¤. ëŒ€ì‹  ë‹¹ì‹ ì˜ ê²½í—˜ì„ **ê²©ì¡° ìˆëŠ” ìì‚°**ìœ¼ë¡œ ë‚¨ê²¨ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?',
          'í©ì–´ì§„ ì¡°ê°ë“¤ì„ ëª¨ì•„ í•œ ê¶Œì˜ ì±…, í˜¹ì€ í’ˆìœ„ ìˆëŠ” ê²°ê³¼ë¬¼ë¡œ ì—®ì–´ë‚´ë©´, êµ³ì´ ë§í•˜ì§€ ì•Šì•„ë„ ì‚¬ëŒë“¤ì€ ë‹¹ì‹ ì˜ ê¹Šì´ë¥¼ ì•Œì•„ë³´ê²Œ ë©ë‹ˆë‹¤.'
        ]
      }
    ]
  }
}

function ResultPage({ type, nickname, onRestart }) {
  const result = typeResults[type]
  const deep = deepReports[type]
  const [shareUrl, setShareUrl] = useState('')
  
  useEffect(() => {
    // í˜„ì¬ URLì— ê²°ê³¼ íƒ€ì… íŒŒë¼ë¯¸í„° ì¶”ê°€
    const url = new URL(window.location.href)
    url.searchParams.set('type', type)
    setShareUrl(url.toString())
  }, [type])
  
  if (!result) {
    return <div>ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
  }
  
  const handleShare = async () => {
    const shareData = {
      title: `ë‚˜ì˜ ì„±ì¥ìœ í˜•: ${result.emoji} ${result.name}`,
      text: `ì¤‘ì¥ë…„ ì„±ì¥ìœ í˜• ì§„ë‹¨ê²€ì‚¬ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!`,
      url: shareUrl
    }
    
    try {
      if (navigator.share) {
        // ëª¨ë°”ì¼ì—ì„œ ë„¤ì´í‹°ë¸Œ ê³µìœ  ê¸°ëŠ¥ ì‚¬ìš©
        await navigator.share(shareData)
      } else {
        // ë°ìŠ¤í¬í†±ì—ì„œ URL í´ë¦½ë³´ë“œ ë³µì‚¬
        await navigator.clipboard.writeText(shareUrl)
        alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')
      }
    } catch (error) {
      // ì‚¬ìš©ìê°€ ê³µìœ ë¥¼ ì·¨ì†Œí•œ ê²½ìš° ë˜ëŠ” ì—ëŸ¬ ë°œìƒ
      if (error.name !== 'AbortError') {
        // í´ë¦½ë³´ë“œ ë³µì‚¬ë¡œ ëŒ€ì²´
        try {
          await navigator.clipboard.writeText(shareUrl)
          alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')
        } catch (clipboardError) {
          // í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ìˆ˜ë™ ë³µì‚¬ ì•ˆë‚´
          prompt('ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', shareUrl)
        }
      }
    }
  }
  
  const handleDownloadImage = async () => {
    const target = document.querySelector('.result-container')
    const html2canvas = window.html2canvas
    if (!target || !html2canvas) {
      alert('ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤.')
      return
    }
    
    try {
      const canvas = await html2canvas(target, {
        backgroundColor: '#ffffff',
        scale: window.devicePixelRatio > 1 ? 2 : 1.5
      })
      const link = document.createElement('a')
      link.download = `curious-growth-result-${type}.png`
      link.href = canvas.toDataURL('image/png')
      link.click()
    } catch (error) {
      console.error('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error)
      alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.')
    }
  }
  
  return (
    <div className="result-page">
      <div className="result-container">
        {/* í—¤ë” */}
        <div className="result-header">
          <div className="result-emoji">{result.emoji}</div>
          <h1 className="result-title">
            {nickname ? `${nickname}ë‹˜ì€` : 'ë‹¹ì‹ ì€'} {deep?.label || result.name} ìœ í˜•ì´ì—ìš”
          </h1>
          {deep && (
            <>
              <p className="result-subtitle">[{deep.subtitle}]</p>
              <p className="result-tagline">{deep.tagline}</p>
            </>
          )}
        </div>
        
        {/* ë””í…Œì¼ ë¦¬í¬íŠ¸ */}
        {deep && (
          <section className="deep-report">
            {deep.sections.map((section, index) => (
              <div key={index} className="deep-section">
                <h2 className="deep-section-title">{section.title}</h2>
                {section.body.map((paragraph, i) => (
                  <p
                    key={i}
                    className="deep-section-text"
                    dangerouslySetInnerHTML={{
                      __html: paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    }}
                  />
                ))}
              </div>
            ))}
          </section>
        )}
        
        {/* ì•¡ì…˜ ë²„íŠ¼ */}
        <div className="result-actions">
          <a 
            className="curious-link-button"
            href="https://go.curious-500.com/4qBxoNE"
            target="_blank"
            rel="noreferrer"
          >
            â˜• íë¦¬ì–´ìŠ¤ ëŒ€í‘œì™€ ìƒë‹´í•˜ê¸°
          </a>
          <button className="image-button" onClick={handleDownloadImage}>
            ğŸ–¼ ê²°ê³¼ë¥¼ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°
          </button>
          <button className="share-button" onClick={handleShare}>
            ğŸ“¤ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°
          </button>
          <button className="restart-button" onClick={onRestart}>
            ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
          </button>
        </div>
      </div>
    </div>
  )
}

export default ResultPage
